<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ResourcesMojo.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">itf-maven-plugin</a> &gt; <a href="index.source.html" class="el_package">com.soebes.itf.maven.plugin</a> &gt; <span class="el_source">ResourcesMojo.java</span></div><h1>ResourcesMojo.java</h1><pre class="source lang-java linenums">package com.soebes.itf.maven.plugin;

/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

import org.apache.maven.execution.MavenSession;
import org.apache.maven.model.Resource;
import org.apache.maven.plugin.AbstractMojo;
import org.apache.maven.plugin.MojoExecutionException;
import org.apache.maven.plugins.annotations.Component;
import org.apache.maven.plugins.annotations.LifecyclePhase;
import org.apache.maven.plugins.annotations.Mojo;
import org.apache.maven.plugins.annotations.Parameter;
import org.apache.maven.project.MavenProject;
import org.apache.maven.shared.filtering.MavenFilteringException;
import org.apache.maven.shared.filtering.MavenResourcesExecution;
import org.apache.maven.shared.filtering.MavenResourcesFiltering;

import java.io.File;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Collections;
import java.util.LinkedHashSet;
import java.util.List;

/**
 * Copy resources from src/test/resources-its to the appropriate location.
 *
 * @implNote Copied the majority of the code from maven-resources-plugin.
 */
@Mojo(name = &quot;resources-its&quot;, defaultPhase = LifecyclePhase.PROCESS_TEST_RESOURCES, threadSafe = true)
<span class="nc" id="L49">public class ResourcesMojo extends AbstractMojo {</span>

  @Parameter(defaultValue = &quot;${project}&quot;, readonly = true, required = true)
  private MavenProject project;

  @Parameter(defaultValue = &quot;${session}&quot;, readonly = true, required = true)
  private MavenSession session;

  /**
   * The character encoding to use when reading and writing filtered resources.
   */
  @Parameter(defaultValue = &quot;${project.build.sourceEncoding}&quot;)
  private String encoding;

  /**
   * The character encoding to use when reading and writing filtered properties files.
   * If not specified, it will default to the value of the &quot;encoding&quot; parameter.
   */
  @Parameter
  private String propertiesEncoding;

  /**
   * The list of additional filter properties files to be used along with System and project properties, which would
   * be used for the filtering.
   *
   */
  @Parameter(defaultValue = &quot;${project.build.filters}&quot;, readonly = true)
  private List&lt;String&gt; buildFilters;

  @Component(role = MavenResourcesFiltering.class, hint = &quot;default&quot;)
  private MavenResourcesFiltering mavenResourcesFiltering;

  /**
   * Expressions preceded with this string won't be interpolated. Anything else preceded with this string will be
   * passed through unchanged. For example {@code \${foo}} will be replaced with {@code ${foo}} but {@code \\${foo}}
   * will be replaced with {@code \\value of foo}, if this parameter has been set to the backslash.
   */
  @Parameter
  private String escapeString;

  /**
   * Copy any empty directories included in the Resources.
   */
  @Parameter(defaultValue = &quot;false&quot;)
  private boolean includeEmptyDirs;

  /**
   * The following extensions are already defined and will not being filtered.
   * &lt;ul&gt;
   *   &lt;li&gt;jpg&lt;/li&gt;
   *   &lt;li&gt;jar&lt;/li&gt;
   *   &lt;li&gt;war&lt;/li&gt;
   *   &lt;li&gt;ear&lt;/li&gt;
   *   &lt;li&gt;aar&lt;/li&gt;
   *   &lt;li&gt;rar&lt;/li&gt;
   *   &lt;li&gt;har&lt;/li&gt;
   *   &lt;li&gt;sar&lt;/li&gt;
   *   &lt;li&gt;zip&lt;/li&gt;
   *   &lt;li&gt;tar&lt;/li&gt;
   *   &lt;li&gt;tar.gz&lt;/li&gt;
   * &lt;/ul&gt;
   */
  @Parameter
  private List&lt;String&gt; nonFilteredFileExtensions;
  /**
   * Whether to escape backslashes and colons in windows-style paths.
   */
  @Parameter(defaultValue = &quot;true&quot;)
  private boolean escapeWindowsPaths;

  /**
   * &lt;p&gt;
   * Set of delimiters for expressions to filter within the resources. These delimiters are specified in the form
   * {@code beginToken*endToken}. If no {@code *} is given, the delimiter is assumed to be the same for start and end.
   * &lt;/p&gt;
   * &lt;p&gt;
   * So, the default filtering delimiters might be specified as:
   * &lt;/p&gt;
   *
   * &lt;pre&gt;
   * &amp;lt;delimiters&amp;gt;
   *   &amp;lt;delimiter&amp;gt;@&amp;lt;/delimiter&amp;gt;
   * &amp;lt;/delimiters&amp;gt;
   * &lt;/pre&gt;
   * &lt;p&gt;
   * Since the {@code @} delimiter is the same on both ends, we don't need to specify {@code @*@} (though we can).
   * &lt;/p&gt;
   */
  @Parameter(defaultValue = &quot;@&quot;)
  private LinkedHashSet&lt;String&gt; delimiters;

  /**
   * By default files like {@code .gitignore}, {@code .cvsignore} etc. are NOT excluded which means they will being
   * copied. If you need them for a particular reason you can do that by settings this to {@code }. This means
   * all files like the following will be copied.
   * &lt;ul&gt;
   * &lt;li&gt;Misc: &amp;#42;&amp;#42;/&amp;#42;~, &amp;#42;&amp;#42;/#&amp;#42;#, &amp;#42;&amp;#42;/.#&amp;#42;, &amp;#42;&amp;#42;/%&amp;#42;%, &amp;#42;&amp;#42;/._&amp;#42;&lt;/li&gt;
   * &lt;li&gt;CVS: &amp;#42;&amp;#42;/CVS, &amp;#42;&amp;#42;/CVS/&amp;#42;&amp;#42;, &amp;#42;&amp;#42;/.cvsignore&lt;/li&gt;
   * &lt;li&gt;RCS: &amp;#42;&amp;#42;/RCS, &amp;#42;&amp;#42;/RCS/&amp;#42;&amp;#42;&lt;/li&gt;
   * &lt;li&gt;SCCS: &amp;#42;&amp;#42;/SCCS, &amp;#42;&amp;#42;/SCCS/&amp;#42;&amp;#42;&lt;/li&gt;
   * &lt;li&gt;VSSercer: &amp;#42;&amp;#42;/vssver.scc&lt;/li&gt;
   * &lt;li&gt;MKS: &amp;#42;&amp;#42;/project.pj&lt;/li&gt;
   * &lt;li&gt;SVN: &amp;#42;&amp;#42;/.svn, &amp;#42;&amp;#42;/.svn/&amp;#42;&amp;#42;&lt;/li&gt;
   * &lt;li&gt;GNU: &amp;#42;&amp;#42;/.arch-ids, &amp;#42;&amp;#42;/.arch-ids/&amp;#42;&amp;#42;&lt;/li&gt;
   * &lt;li&gt;Bazaar: &amp;#42;&amp;#42;/.bzr, &amp;#42;&amp;#42;/.bzr/&amp;#42;&amp;#42;&lt;/li&gt;
   * &lt;li&gt;SurroundSCM: &amp;#42;&amp;#42;/.MySCMServerInfo&lt;/li&gt;
   * &lt;li&gt;Mac: &amp;#42;&amp;#42;/.DS_Store&lt;/li&gt;
   * &lt;li&gt;Serena Dimension: &amp;#42;&amp;#42;/.metadata, &amp;#42;&amp;#42;/.metadata/&amp;#42;&amp;#42;&lt;/li&gt;
   * &lt;li&gt;Mercurial: &amp;#42;&amp;#42;/.hg, &amp;#42;&amp;#42;/.hg/&amp;#42;&amp;#42;&lt;/li&gt;
   * &lt;li&gt;GIT: &amp;#42;&amp;#42;/.git, &amp;#42;&amp;#42;/.gitignore, &amp;#42;&amp;#42;/.gitattributes, &amp;#42;&amp;#42;/.git/&amp;#42;&amp;#42;&lt;/li&gt;
   * &lt;li&gt;Bitkeeper: &amp;#42;&amp;#42;/BitKeeper, &amp;#42;&amp;#42;/BitKeeper/&amp;#42;&amp;#42;, &amp;#42;&amp;#42;/ChangeSet,
   * &amp;#42;&amp;#42;/ChangeSet/&amp;#42;&amp;#42;&lt;/li&gt;
   * &lt;li&gt;Darcs: &amp;#42;&amp;#42;/_darcs, &amp;#42;&amp;#42;/_darcs/&amp;#42;&amp;#42;, &amp;#42;&amp;#42;/.darcsrepo,
   * &amp;#42;&amp;#42;/.darcsrepo/&amp;#42;&amp;#42;&amp;#42;&amp;#42;/-darcs-backup&amp;#42;, &amp;#42;&amp;#42;/.darcs-temp-mail
   * &lt;/ul&gt;
   */
  @Parameter(defaultValue = &quot;false&quot;)
  private boolean addDefaultExcludes;

  /**
   * The output directory into which to copy the resources.
   */
  @Parameter(defaultValue = &quot;${project.build.outputDirectory}&quot;, required = true)
  private File outputDirectory;

  /**
   * The list of resources we want to transfer.
   * &lt;p&gt;
   * &lt;li&gt;default: &lt;code&gt;src/test/resources-its&lt;/code&gt;&lt;/li&gt;
   * &lt;/p&gt;
   */
  @Parameter(readonly = true)
  private List&lt;Resource&gt; resources;

  /**
   * Overwrite existing files even if the destination files are newer.
   */
  @Parameter(defaultValue = &quot;false&quot;)
  private boolean overwrite;

  /**
   * &lt;p&gt;
   * List of plexus components hint which implements
   * {@link MavenResourcesFiltering#filterResources(MavenResourcesExecution)}. They will be executed after the
   * resources copying/filtering.
   * &lt;/p&gt;
   */
  @Parameter
  private List&lt;String&gt; mavenFilteringHints;

<span class="nc" id="L199">  private List&lt;MavenResourcesFiltering&gt; mavenFilteringComponents = new ArrayList&lt;&gt;();</span>

  /**
   * stop searching endToken at the end of line
   */
  @Parameter(defaultValue = &quot;false&quot;)
  private boolean supportMultiLineFiltering;

  /**
   * Support filtering of filenames folders etc.
   */
  @Parameter(defaultValue = &quot;false&quot;)
  private boolean fileNameFiltering;

  /**
   * {@inheritDoc}
   */
  public void execute()
      throws MojoExecutionException {

<span class="nc" id="L219">    Resource resource = new Resource();</span>
<span class="nc" id="L220">    resource.setDirectory(&quot;src/test/resources-its&quot;);</span>
<span class="nc" id="L221">    resource.setTargetPath(project.getBuild().getTestOutputDirectory());</span>
<span class="nc" id="L222">    ArrayList&lt;String&gt; includes = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L223">    includes.add(&quot;**/**&quot;);</span>
<span class="nc" id="L224">    resource.setIncludes(includes);</span>

    //TODO: Document the default excludes we are using?
<span class="nc" id="L227">    resource.setExcludes(Collections.emptyList());</span>

    // Enable filtering of resources
<span class="nc" id="L230">    resource.setFiltering(true);</span>

    //TODO: Need to clean up.
<span class="nc" id="L233">    this.resources = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L234">    this.resources.add(resource);</span>

<span class="nc bnc" id="L236" title="All 4 branches missed.">    if (Helper.isBlank(encoding) &amp;&amp; isFilteringEnabled(this.resources)) {</span>
<span class="nc" id="L237">      getLog().warn(&quot;File encoding has not been set, using platform encoding &quot;</span>
<span class="nc" id="L238">          + System.getProperty(&quot;file.encoding&quot;)</span>
          + &quot;. Build is platform dependent!&quot;);
<span class="nc" id="L240">      getLog().warn(&quot;See https://maven.apache.org/general.html#encoding-warning&quot;);</span>
    }

    try {
<span class="nc" id="L244">      MavenResourcesExecution mavenResourcesExecution =</span>
<span class="nc" id="L245">          new MavenResourcesExecution(this.resources, this.outputDirectory, project, encoding, Collections.emptyList(),</span>
<span class="nc" id="L246">              Collections.emptyList(), session);</span>

<span class="nc" id="L248">      mavenResourcesExecution.setEscapeWindowsPaths(escapeWindowsPaths);</span>

      // never include project build filters in this call, since we've already accounted for the POM build filters
      // above, in getCombinedFiltersList().
<span class="nc" id="L252">      mavenResourcesExecution.setInjectProjectBuildFilters(false);</span>

<span class="nc" id="L254">      mavenResourcesExecution.setEscapeString(escapeString);</span>
<span class="nc" id="L255">      mavenResourcesExecution.setOverwrite(overwrite);</span>
<span class="nc" id="L256">      mavenResourcesExecution.setIncludeEmptyDirs(includeEmptyDirs);</span>
<span class="nc" id="L257">      mavenResourcesExecution.setSupportMultiLineFiltering(supportMultiLineFiltering);</span>
<span class="nc" id="L258">      mavenResourcesExecution.setFilterFilenames(fileNameFiltering);</span>
<span class="nc" id="L259">      mavenResourcesExecution.setAddDefaultExcludes(addDefaultExcludes);</span>

      // We don't define supplemental properties at the moment.
<span class="nc" id="L262">      mavenResourcesExecution.setAdditionalProperties(null);</span>

      //Using only `@project.version@`...
<span class="nc" id="L265">      mavenResourcesExecution.setDelimiters(delimiters);</span>

<span class="nc" id="L267">      mavenResourcesExecution.setPropertiesEncoding(propertiesEncoding);</span>

      //Default list of extensions which are not filtered.
<span class="nc" id="L270">      List&lt;String&gt; filter = Arrays.asList(&quot;jpg&quot;, &quot;jar&quot;, &quot;war&quot;, &quot;ear&quot;, &quot;aar&quot;, &quot;rar&quot;, &quot;har&quot;, &quot;sar&quot;, &quot;zip&quot;, &quot;tar&quot;, &quot;tar.gz&quot;);</span>
<span class="nc" id="L271">      mavenResourcesExecution.setNonFilteredFileExtensions(filter);</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">      if (nonFilteredFileExtensions != null) {</span>
<span class="nc" id="L273">        mavenResourcesExecution.setNonFilteredFileExtensions(nonFilteredFileExtensions);</span>
      }
<span class="nc" id="L275">      mavenResourcesFiltering.filterResources(mavenResourcesExecution);</span>

<span class="nc" id="L277">    } catch (MavenFilteringException e) {</span>
<span class="nc" id="L278">      throw new MojoExecutionException(e.getMessage(), e);</span>
<span class="nc" id="L279">    }</span>
<span class="nc" id="L280">  }</span>

  /**
   * Determines whether filtering has been enabled for any resource.
   *
   * @param theResources The set of resources to check for filtering, may be &lt;code&gt;null&lt;/code&gt;.
   * @return &lt;code&gt;true&lt;/code&gt; if at least one resource uses filtering, &lt;code&gt;false&lt;/code&gt; otherwise.
   */
  private boolean isFilteringEnabled(Collection&lt;Resource&gt; theResources) {
<span class="nc bnc" id="L289" title="All 2 branches missed.">    if (theResources != null) {</span>
<span class="nc" id="L290">      return theResources.stream().anyMatch(Resource::isFiltering);</span>
    }
<span class="nc" id="L292">    return false;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>